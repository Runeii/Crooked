function resetScroll(){nav.classList.add("hide"),last_scroll=0}function animate_stage(){(body.classList.contains("default")||body.classList.contains("midnight"))&&(body.classList.add("sunrise"),setTimeout(function(){body.classList.add("daytime")},5e3))}function swapWorld(a){var b=$(a).attr("world");console.log("Now entering: "+b),$(window).scrollTop(0),header.classList.add("entering"),body.className=b,console.log(a),a[0].style.cssText=null,body.classList.remove("transitioning"),refreshElements(b)}function refreshElements(a){var b=worldData[a],c="";header.innerHTML="",$.each(b,function(b,d){c+='<img src="'+d+'" id="'+a+"_"+b+'"/>'}),header.innerHTML=c,lede.innerHTML=worldData.copy[a].lede,introduction.innerHTML=worldData.copy[a].introduction,resetScroll(),setupParallax(a)}function setupParallax(){var a,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",c=worldData.layers[b],d=worldData[b];a="default"==b?"#":"#"+b+"_",$.each(c,function(b,c){for(var e=0,f=c.length;e<f;e++)$(a+c[e]).addClass("parallax_"+b),delete d[c[e]]}),$.each(d,function(b){$(a+b).addClass("parallax_five")}),parallax_one=$(".parallax_one"),parallax_two=$(".parallax_two"),parallax_three=$(".parallax_three"),parallax_four=$(".parallax_four"),parallax_five=$(".parallax_five")}function getNavUrl(){return window.location.search.replace("?","")}function getParameters(a){var b={};a=a.toLowerCase(),a=a.split("&");for(var c=a.length,d=0;d<c;d++){var e=a[d].slice(0,a[d].search("=")),f=a[d].slice(a[d].search("=")).replace("=","");b[e]=f}return b}!function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}();var passiveSupported=!1;try{var options=Object.defineProperty({},"passive",{get:function(){passiveSupported=!0}});window.addEventListener("test",null,options)}catch(a){}var body=document.body,nav=document.getElementById("nav"),header=document.getElementById("header"),sun=document.getElementById("sun"),lede=document.querySelector("#welcome .lede"),introduction=document.querySelector("#welcome .introduction"),parallax_one,parallax_two,parallax_three,parallax_four,parallax_five,transitioning=!1,worldData,windowHeight=$(window).height();$.getJSON("worlds.json",function(a){console.log("Worlds loaded"),worldData=a,setupParallax(getParameters(getNavUrl()).world)});var last_scroll=windowHeight/100,ticking=!1;window.addEventListener("scroll",function(a){this_scroll=window.scrollY,this_scroll>=1.1*last_scroll?(console.log("Hide"),nav.classList.add("hide"),last_scroll=this_scroll):this_scroll<=last_scroll/1.1&&(console.log("reveal"),nav.classList.remove("hide"),last_scroll=this_scroll),ticking||window.requestAnimationFrame(function(){var a=-1*this_scroll;parallax_one.css({"margin-bottom":a/5+"px"}),parallax_two.css({"margin-bottom":a/4+"px"}),parallax_three.css({"margin-bottom":a/3+"px"}),parallax_four.css({"margin-bottom":a/2+"px"}),parallax_five.css({"margin-bottom":a+"px"}),ticking=!1}),ticking=!0}),animate_stage(),$(".explore-button a").click(function(){if(!1===transitioning){transitioning=!0;var a=$("#"+this.getAttribute("target"));a.parents().addClass("target_parent"),a.css({top:a.offset().top-$(window).scrollTop(),left:a.offset().left,width:a.width(),position:"fixed"}).queue(function(){a.addClass("target_world"),body.classList.add("transitioning"),$(this).dequeue()}),a.one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(b){swapWorld(a)})}return!1});